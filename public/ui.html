<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DNS æŸ¥è¯¢ UI</title>
  <style>
    :root{ --bg:#0b1020; --card:#121836; --accent:#6aa6ff; --border:#2a3170; --text:#e8ecff; --muted:#c8cff9}
    *{ box-sizing:border-box }
    body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:var(--text)}
    .wrap{ max-width:980px; margin:0 auto; padding:32px 16px }
    .title{ font-size:32px; margin:0 0 24px }
    .panel{ background:var(--card); border:1px solid var(--border); padding:18px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{ display:flex; gap:12px; flex-wrap:wrap; margin:10px 0 16px}
    .input, select{ flex:1; min-width:220px; background:#0f1430; border:1px solid var(--border); color:var(--text); padding:12px 14px; border-radius:10px; outline:none }
    .btn{ background:var(--accent); color:#05122b; border:0; padding:12px 18px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 10px 22px rgba(106,166,255,.25) }
    .btn:disabled{ opacity:.65; cursor:not-allowed }
    .muted{ color:var(--muted) }
    pre{ background:#0b1333; border:1px solid var(--border); padding:14px; border-radius:12px; overflow:auto }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:16px }
    @media (max-width: 800px){ .grid{ grid-template-columns: 1fr } }
    .tag{ display:inline-block; background:#0f1430; border:1px solid var(--border); color:var(--muted); padding:2px 8px; border-radius:999px; font-size:12px; margin-right:6px }
    a{ color:#8fb0ff; text-decoration:none }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">ğŸ” DNS æŸ¥è¯¢ UI</h1>
    <div class="panel">
      <div class="row">
        <input id="name" class="input" placeholder="example.com" value="example.com">
        <select id="type">
          <option>A</option><option>AAAA</option><option>CNAME</option><option>TXT</option>
          <option>NS</option><option>MX</option><option>SOA</option><option>CAA</option>
        </select>
        <button id="btn" class="btn">æŸ¥è¯¢</button>
      </div>
      <div class="muted">è°ƒç”¨ <code>/resolve?name=...&type=...</code> è¿”å› JSONã€‚</div>
    </div>

    <div style="height:16px"></div>

    <div class="grid">
      <div class="panel">
        <div class="muted">ç®€è¡¨</div>
        <div id="table"></div>
      </div>
      <div class="panel">
        <div class="muted">åŸå§‹ JSON</div>
        <pre id="raw">{}</pre>
      </div>
    </div>

    <div style="margin-top:18px" class="muted">
      åŒæ—¶æ”¯æŒäºŒè¿›åˆ¶ DoHï¼š<code>GET /dns-query?dns=</code> æˆ– <code>POST /dns-query</code>ï¼ˆ<code>application/dns-message</code>ï¼‰ã€‚
    </div>
  </div>

<script>
const $ = s=>document.querySelector(s);
const btn = $('#btn');
const nameI = $('#name');
const typeS = $('#type');
const raw = $('#raw');
const table = $('#table');

function rrToString(rr){
  if(!rr) return '';
  if(rr.data) return rr.data;
  if(rr.ip) return rr.ip;
  if(rr.txt) return rr.txt;
  try { return JSON.stringify(rr); } catch { return String(rr); }
}

function renderTable(json){
  if(!json || !json.Answer){ table.innerHTML = '<div class="muted">æ— ç»“æœ</div>'; return; }
  const rows = json.Answer.map(a=>`<tr>
    <td><span class="tag">${a.type}</span></td>
    <td>${a.name||''}</td>
    <td>${rrToString(a)}</td>
    <td>${a.TTL ?? a.ttl ?? ''}</td>
  </tr>`).join('');
  table.innerHTML = `<table style="width:100%; border-collapse:collapse">
    <thead><tr><th>ç±»å‹</th><th>åç§°</th><th>å€¼</th><th>TTL</th></tr></thead>
    <tbody>${rows}</tbody>
  </table>`;
}

async function query(){
  const name = nameI.value.trim();
  const type = typeS.value;
  if(!name){ alert('è¯·è¾“å…¥åŸŸå'); return; }
  btn.disabled = true;
  btn.textContent = 'æŸ¥è¯¢ä¸­â€¦';
  try{
    const res = await fetch(`/resolve?name=${encodeURIComponent(name)}&type=${encodeURIComponent(type)}`);
    const json = await res.json();
    raw.textContent = JSON.stringify(json, null, 2);
    renderTable(json);
  } catch (e){
    raw.textContent = String(e);
    table.innerHTML = '<div class="muted">è¯·æ±‚å¤±è´¥</div>';
  } finally {
    btn.disabled = false;
    btn.textContent = 'æŸ¥è¯¢';
  }
}

btn.addEventListener('click', query);
nameI.addEventListener('keydown', e=>{ if(e.key==='Enter') query(); });
</script>
</body>
</html>
